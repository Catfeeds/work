function playAndShow(a){var b=0;var c={playmate1:["/static/act/kan/images/mm1start.jpg","/static/act/kan/images/mm1after.jpg"],playmate2:["/static/act/kan/images/mm2start.jpg","/static/act/kan/images/mm2after.jpg"],playmate3:["/static/act/kan/images/mm3start.jpg","/static/act/kan/images/mm3after.jpg"]};
$(".hotspace lable").each(function(){$(this).click(function(){$(".alert").removeClass("hide");$(".info span").html("<i class='loading-icon'></i>");$(".alert").attr("data-lock","0");
var m=setInterval(function(){if($(".alert").attr("data-lock")==2){$(".page1").addClass("hide");$(".page2").removeClass("hide");$(".alert").addClass("hide");
$(".alert").attr("data-lock","0");clearInterval(m);}},500);b=$(this).attr("class").substr(8);var g=$(window).width();var d=$(window).height();var h=document.getElementById("canvas");
var e=h.getContext("2d");var j=new Image();var k=0;h.width=g;h.height=d;j.src=c[$(this).attr("class")][0];j.onload=function(n){e.drawImage(j,0,0,j.width,j.height,0,0,g,d);
h.addEventListener("touchstart",function(o){var p=o.touches[0];during=o.timeStamp;o.preventDefault();console.log(during);});h.addEventListener("touchmove",function(o){var p=o.touches[0];
console.log("touchmove",p.pageX,p.pageY,o);o.preventDefault();setTimeout(function(){l(p.pageX,p.pageY,40,e);},0);});h.addEventListener("touchend",function(o){var p=o.touches[0];
o.preventDefault();k++;if(k>=6||f()>=0.8){$("#canvas").addClass("hide");postBargain(b);$(".active").removeClass("hide");activeShow(b);}});$(".alert").attr("data-lock",$(".alert").attr("data-lock")-0+1);
$(".touchtip").removeClass("hide");};function f(){try{var q=e.getImageData(0,0,g,d);for(var o=0,n=0;o<q.data.length/4;o++){if(q.data[3+4*o]==0){n++;}}console.log(q,n,g*d,n/(g*d));
return n/(g*d);}catch(p){console.log(p);return false;}}function l(n,v,t,p){try{p.globalCompositeOperation="destination-out";p.beginPath();p.arc(n,v,t,0,Math.PI*2,false);
p.fill();}catch(u){console.log(u);var n=parseInt(n);var v=parseInt(v);for(var s=0,o=null;s<2*t;s++){for(var q=0;q<2*t;q++){o=(s-t)*(s-t)+(q-t)*(q-t);if(o<=(t*t)){p.clearRect((n-t+s),(v-t+q),1,1);
}}}}}var i=new Image;i.onload=function(){$(".page2").css("background-image","url("+i.src+")");$(".alert").attr("data-lock",$(".alert").attr("data-lock")-0+1);
};i.src=c[$(this).attr("class")][1];});});$(".active").click(function(){$(".alert .info span").html("");$(".alert").removeClass("hide");$(".alert .info span").html("<i class='loading-icon'></i>");
if($(".alert").attr("data-lock")==2){postBargain(b);}var d=setInterval(function(){if($(".alert").attr("data-lock")==1){$(".page2").addClass("hide");$(".page3").removeClass("hide");
$("body").css({overflow:"auto",height:"auto"});$(".alert").addClass("hide");$(".alert").attr("data-lock","0");clearInterval(d);}else{if($(".alert").attr("data-lock")==2){$(".alert").addClass("hide");
clearInterval(d);}}},500);});}$(".yue").click(function(){$(".pages").addClass("hide");$(".about").removeClass("hide");});$(".btnJoin").click(iWantCreate);
$(".btnIWant").click(iWantCreate);$(".back").click(function(){$(".about").addClass("hide");$(".page3").removeClass("hide");});function iWantCreate(){$(".alert").attr("data-lock","0");
$(".alert").removeClass("hide");$(".alert .info span").html("<i class='loading-icon'></i>");postCreateActive();var a=setInterval(function(){if($(".alert").attr("data-lock")==1){$(".pages").addClass("hide");
$(".create").removeClass("hide");$(".alert").attr("data-lock","0");clearInterval(a);}else{if($(".alert").attr("data-lock")==2){$(".alert").addClass("hide");
clearInterval(a);}}},500);}function postCreateActive(){var b=function(c){console.log(c);if(c.code=="0000"){$(".alert").attr("data-lock","1");$(".btnPlay").attr("href",c.data.activity_url);
}else{if(c.code=="5006"){window.location.href=c.data.activity_url;}else{if(c.code=="5001"){window.location.href=c.data.redirect_url;}else{$(".alert .info span").html(c.msg);
setTimeout(function(){$(".alert").attr("data-lock","2");},2000);}}}};var a=function(){$(".alert .info span").html("网络错误");setTimeout(function(){$(".alert").attr("data-lock","2");
},2000);};ajaxCreateActive(b,a);}function postBargain(a){var c=function(d){console.log(d);if(d.code=="0000"||d.code=="5004"){setTimeout(function(){postRank();
},0);}else{if(d.code=="5001"){window.location.href=d.data.redirect_url;}else{$(".alert .info span").html(d.msg);setTimeout(function(){$(".alert").attr("data-lock","2");
},2000);}}};var b=function(){$(".alert .info span").html("网络错误");setTimeout(function(){$(".alert").attr("data-lock","2");},2000);};ajaxBargain(c,getURLInformation(),a,b);
}function postRank(){var b=function(c){console.log(c);if(c.code=="0000"){playmateShow(c.data.player.playmate);$(".playmateshow-msg").removeClass("hide");
$(".playmateshow-msg-money").html(c.data.player.money);$(".playmateshow-msg-rank").html(c.data.player.rank);btnJoinShow();rankCreate(c.data.ranklist);$(".yue").removeClass("hide");
}else{if(c.code=="5001"){window.location.href=c.data.redirect_url;}else{$(".alert .info span").html(c.msg);$(".alert").removeClass("hide");setTimeout(function(){$(".alert").attr("data-lock","2");
$(".alert").addClass("hide");},2000);}}};var a=function(){};ajaxRank(b,getURLInformation(),a);}function playmateShow(a){var b=new Image();b.src=playmateShowURL(a).url;
b.onload=function(){$(".playmateshow").css({height:playmateShowURL(a).height,"background-image":"url("+b.src+")"});$(".playmateshow-msg").css(playmateShowURL(a).css);
setTimeout(function(){$(".alert").attr("data-lock","1");},2000);};}function btnJoinShow(){var a=$(".loading").attr("data-page");$(".btnJoin-msg").html("");
if(/600|700/i.test(a)){$(".btnJoin").removeClass("hide");$(".btnJoin-msg").html("我也要挑战");}else{if(a=="200"){$(".btnHelps").removeClass("hide");$(".btnHelps-msg").html("马上求助");
}}}function rankCreate(a){var d=["手起刀落，不谢！","江湖人称金牌砍价师","砍价我最强","我为砍价高手带盐","专业砍价20年","砍价不动嘴只刷脸","极速砍价","砍价赢家，为我点赞","哎哟，不错哦。","砍砍砍，砍钱不眨眼。"];$(".rank").removeClass("hide");
var e=$(".rank-ul");for(var c=0;c<a.length;c++){var b=parseInt(Math.random()*d.length);$('<li class="rank-li"><div class="rank-avatar" style="background-image: url('+a[c].headimg_url+');"></div><div class="rank-text"><div class="rank-text-t">'+a[c].nickname+'成功砍价</div><div class="rank-text-b">'+d[b]+'</div></div><div class="rank-money">'+a[c].money+"元</div></li>").appendTo(e);
}}function unablePlayButShow(b){var a=function(){$(".pages").addClass("hide");$(".again").removeClass("hide");$(".again").click(function(){window.location.reload();
});};ajaxRank(createCallback(b),getURLInformation(),a);return false;}function createCallback(a){console.log(a);if(a==700){return callback700=function(b){console.log(b);
if(b.code=="0000"){$("body").css({overflow:"auto",height:"auto"});playmateShow(b.data.player.playmate);$(".playmateshow-msg").removeClass("hide");$(".playmateshow-msg-money").html(b.data.player.money);
$(".playmateshow-msg-rank").html(b.data.player.rank);btnJoinShow();rankCreate(b.data.ranklist);$(".yue").removeClass("hide");loadingRemove();}else{if(b.code=="5001"){window.location.href=b.data.redirect_url;
}else{$(".pages").addClass("hide");$(".page4").removeClass("hide");loadingRemove();}}};}else{if(a==300){return callback300=function(c){console.log(c);if(c.code=="0000"){$("body").css({overflow:"auto",height:"auto"});
var d=c.data.owner.playercnt;var b=c.data.moneytotal;$(".information").removeClass("hide");$(".iconsdouble").removeClass("hide");$(".information").html("有"+d+"位小伙伴帮你砍价"+b+"元，<br />已获得"+ticketMoney(b).money+"元陪练优惠券。<br />距离"+ticketMoney(b).nextMoney+"元目标还差"+(ticketMoney(b).nextMoney*10-b*10)/10+"元，<br />距离终极目标还差"+(600-b*10)/10+"元。");
$(".money").removeClass("hide");if(b>0){$(".moneybarInner").removeClass("hide");setTimeout(function(){$(".moneybarInner").animate({width:b/60*100+"%"},1000,"ease-out");
},2000);}rankCreate(c.data.ranklist);$(".yue").removeClass("hide");loadingRemove();}else{if(c.code=="5001"){window.location.href=c.data.redirect_url;}else{$(".pages").addClass("hide");
$(".page4").removeClass("hide");loadingRemove();}}};}else{if(a==500){return callback500=function(c){console.log(c);if(c.code=="0000"){$("body").css({overflow:"auto",height:"auto"});
$(".information").html("恭喜！"+c.data.owner.coupon_money+"元的约练优惠券已放入您的<br />趣运动钱包。请通过手机号：<br />"+c.data.owner.phone+"登录趣运动APP查看。");var b=new Image();b.onload=function(){$(b).appendTo(".ticket");
loadingRemove();};$(".information").removeClass("hide");$(".ticket").removeClass("hide");$(".page3 .icons").removeClass("hide");$(".page3 .icons .btnUseTicket").removeClass("hide");
b.src=getTicketImageURL(c.data.owner.coupon_money);rankCreate(c.data.ranklist);$(".yue").removeClass("hide");}else{if(c.code=="5001"){window.location.href=c.data.redirect_url;
}else{$(".pages").addClass("hide");$(".page4").removeClass("hide");loadingRemove();}}};}else{if(a==400){return callback400=function(b){console.log(b);if(b.code=="0000"){$("body").css({overflow:"auto",height:"auto"});
$(".information").html("恭喜完成挑战！<br /><br />有"+b.data.owner.playercnt+"位小伙伴帮你砍价60元，<br />已获得60元陪练优惠券。");$(".information").removeClass("hide");$(".money").removeClass("hide");
$(".btnFinish").removeClass("hide");$(".moneybarInner").removeClass("hide");setTimeout(function(){$(".moneybarInner").animate({width:"100%"},1000,"ease-out");
},2000);$(".page3 .icons").removeClass("hide");$(".page3 .icons btnFinish").removeClass("hide");rankCreate(b.data.ranklist);$(".yue").removeClass("hide");
loadingRemove();}else{if(b.code=="5001"){window.location.href=b.data.redirect_url;}else{$(".pages").addClass("hide");$(".page4").removeClass("hide");loadingRemove();
}}};}else{if(a==800){return callback800=function(b){console.log(b);if(b.code=="0000"){$("body").css({overflow:"auto",height:"auto"});$(".information").html($(".loading").attr("data-name")+"已经完成挑战！<br /><br />一共砍价"+b.data.moneytotal+"元。");
$(".information").removeClass("hide");$(".money").removeClass("hide");$(".moneybarInner").removeClass("hide");setTimeout(function(){$(".moneybarInner").animate({width:b.data.moneytotal/60*100+"%"},1000,"ease-out");
},2000);$(".page3 .icons").removeClass("hide");$(".page3 .icons .btnIWant").removeClass("hide");rankCreate(b.data.ranklist);$(".yue").removeClass("hide");
loadingRemove();}else{if(b.code=="5001"){window.location.href=b.data.redirect_url;}else{$(".pages").addClass("hide");$(".page4").removeClass("hide");loadingRemove();
}}};}}}}}}var lock=1;$(".btnGameover").click(function(){$(".check").removeClass("hide");});$(".btnFinish").click(function(){$(".check").removeClass("hide");
});$(".icon-close").click(function(){$(".check").addClass("hide");});$(".phoneNumber").blur(function(){if(!isPhoneNumber()){$(".tip").html("请填写正确的手机号码！");
}else{$(".tip").html("");}});$(".checkCode").blur(function(){if($(this).val()!=""){$(".tip2").html("");}else{$(".tip2").html("请填写验证码");}});$(".btnGetCode").click(function(){$(".tip").html("");
console.log($(".phoneNumber").val());if($(".phoneNumber").val()==""){$(".tip").html("不能为空");return true;}else{if(!isPhoneNumber()){$(".tip").html("请填写正确的手机号码！");
return true;}}if(isPhoneNumber()&&lock){lock=0;var a=$(".phoneNumber").val();postGetSmsCode(a);}});$(".btnGetTicket").click(function(){$(".tip2").html("");
if($(".checkCode").val()==""){$(".tip2").html("不能为空");return true;}if(isCode()&&isPhoneNumber()){$(".alert").removeClass("hide");$(".info span").html("请稍候！");
var b=$(".phoneNumber").val();var a=$(".checkCode").val();postCash(b,a);}else{$(".tip2").html("请完善信息");}});$(".close").click(function(){$(".alert").addClass("hide");
$(".close").addClass("hide");});function postGetSmsCode(b){var c=function(d){console.log(d);if(d.code==="0000"){overTime();$(".tip").html(d.msg);}else{lock=1;
$(".tip").html(d.msg);}};var a=function(){};ajaxGetSmsCode(c,b,a);}function postCash(c,a){var d=function(f){if(f.code==="0000"){$(".information").html("恭喜！"+f.data.money+"元的约练优惠券已放入您的<br />趣运动钱包。请通过手机号：<br />"+c+"登录趣运动APP查看。");
var e=new Image();e.onload=function(){$(e).appendTo(".ticket");$(".info span").html(f.msg);$(".close").removeClass("hide");};$(".page3 .icons").addClass("hide");
$(".iconsdouble").removeClass("hide");$(".ticket").removeClass("hide");$(".money").addClass("hide");$(".check").addClass("hide");$(".btnGameover").addClass("hide");
$(".btnHelp").addClass("hide");$(".btnUse").removeClass("hide");e.src=getTicketImageURL(f.data.money);}else{$(".info span").html(f.msg);$(".close").removeClass("hide");
}};var b=function(){$(".alert").addClass("hide");};ajaxCash(d,getURLInformation(),c,a,b);}function ticketMoney(a){var b={};var a=a*10;if(a<200){b.money=0;
b.nextMoney=20;}else{if(a>=200&&a<600){if(a%100<80){b.money=parseInt(a/100)*10;b.nextMoney=b.money+10;}else{b.money=parseInt(a/100)*10+10;if(b.money!=60){b.nextMoney=b.money+10;
}else{b.nextMoney=b.money;}}}else{if(a==600){b.money=60;b.nextMoney=60;}}}return b;}function isPhoneNumber(){if(!isNaN($(".phoneNumber").val()-"0")==true&&$(".phoneNumber")[0].value.length==11&&/13|14|15|17|18/i.test($(".phoneNumber")[0].value.substring(0,2))){return true;
}else{return false;}}function overTime(){var a=60;$(".btnGetCode span").html(a+"秒后重获");$(".btnGetCode").addClass("lock");var b=setInterval(function(){a--;
$(".btnGetCode span").html(a+"秒后重获");if(a==0){$(".btnGetCode span").html("重新获取");lock=1;$(".btnGetCode").removeClass("lock");clearInterval(b);}},1000);
}function isCode(){if(!isNaN($(".checkCode").val()-"0")==true){return true;}else{return false;}}