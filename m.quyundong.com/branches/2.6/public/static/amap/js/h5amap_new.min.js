$(document).ready(function(){navigator.geolocation.getCurrentPosition(function(a){AMap.convertFrom([a.coords.longitude,a.coords.latitude],"gps",function(c,b){if(c!="error"){$("body").attr("data-location-lnglat",b.locations[0].lng+","+b.locations[0].lat);
}});});});var venueLng=null;var venueLat=null;var venueLnglat=[];var markerName="";var setZoom=16;var address="";var amapKey=$("body").attr("data-amap-key");
var zIndex=1000;if(!!stopData[0]){var useStopData=stopData;$(".footer .venue").addClass("hide");$(".footer .stop").removeClass("hide");}if(!venueData.vAddress){venueData.vAddress="地址出错";
}if(!venueData.vName){venueData.vName="名称有误";}if(!!venueData.vLnglat){venueLnglat=venueData.vLnglat;var orilnglat=new AMap.LngLat(venueLnglat[0]-0,venueLnglat[1]-0);
}else{venueLnglat=["116.231700","39.542700"];markerName="位置出错";setZoom=9;}$(".venue .f-center span").html(venueData.vName);$(".venue .f-right a").click(function(){gotoSomeWhere(venueData.vLnglat,venueData.vName);
});function BuildDataAndSlider(a){this.dom=a;this.init();}BuildDataAndSlider.prototype.init=function(){this.ul=document.createElement("ul");this.ul.style.width=$(window).width()*stopData.length+"px";
for(var b=0;b<stopData.length;b++){this.ul.innerHTML+="<li style='width:"+100/stopData.length+"%'><div class='f-left'><i><img src='/static/amap/images/p-location.png'></i></div><div class='f-center'><span>"+stopData[b].stopName+"</span></div><div class='f-right'><a data-lnglat="+stopData[b].stopLnglat+" onclick=gotoSomeWhere(["+stopData[b].stopLnglat+"],'"+stopData[b].stopName+"')>查看路线 </a></div></li>";
}this.dom.appendChild(this.ul);for(var a=0;a<stopData.length;a++){$(".circle-bar")[0].innerHTML+="<i></i>";}};function NMPhotoSlider(b,a){this.dom=b;this.index=a||0;
this.init();this.bindEvent();}NMPhotoSlider.prototype.init=function(){$(".circle-bar i").eq(this.index).addClass("cur");this.width=$(window).width()*stopData.length;
this.liWidth=$(window).width();this.totle=this.dom.childNodes.length;this.dom.style.width=this.width+"px";this.windowWidth=$(window).width();this.lastOffset=(this.index*-1)*(this.width/this.dom.childNodes.length);
this.changeX=0;this.end=false;this.dom.style.webkitTransform="translate3d("+(this.lastOffset)+"px, 0, 0)";this.dom.style.transform="translate3d("+(this.lastOffset)+"px, 0, 0)";
};NMPhotoSlider.prototype.bindEvent=function(){var a=(function a(d){d.target.addEventListener("touchmove",b,false);d.target.addEventListener("touchend",c,false);
this.startTime=new Date()*1;this.end=false;if(d.touches){this.startX=d.touches[0].pageX;}else{this.startX=d.pageX;}}).bind(this);var b=(function b(d){d.preventDefault();
if(!!this.end){return false;}if(d.touches){this.offsetX=d.targetTouches[0].pageX-this.startX;}else{this.offsetX=d.pageX-this.startX;}this.changeX=this.offsetX+this.lastOffset;
if(this.changeX>=0){this.changeX=0;}else{if(this.changeX<=-(this.width-this.windowWidth)){this.changeX=-(this.width-this.windowWidth);}}this.dom.style.webkitTransform="translate3d("+(this.changeX)+"px, 0, 0)";
this.dom.style.transform="translate3d("+(this.changeX)+"px, 0, 0)";}).bind(this);var c=(function c(e){var d=new Date()*1;this.end=true;if(!isAnimation(this.dom)&&this.changeX-this.lastOffset!=0){if((d-this.startTime<=300&&this.offsetX>0)||(Math.abs(this.offsetX)>=this.liWidth/6&&this.offsetX>0)){this.index=this.index-1;
if(this.index<0){this.index=0;}}else{if((d-this.startTime<=300&&this.offsetX<0)||(Math.abs(this.offsetX)>=this.liWidth/6&&this.offsetX<0)){this.index=this.index*1+1;
if(this.index>this.totle-1){this.index=this.totle-1;}}}this.changeX=this.index*-this.liWidth;$(this.dom).animate({transform:"translate3d("+this.changeX+"px,0,0)","-webkit-transform":"translate3d("+this.changeX+"px,0,0)"},300,"linear",0);
map.setCenter(stopData[this.index].stopLnglat);$(".circle-bar i").removeClass("cur");$(".circle-bar i").eq(this.index).addClass("cur");showBar(this.index);
}this.lastOffset=this.changeX;}).bind(this);this.dom.addEventListener("touchstart",a,false);};function showBar(b){var a=stopData.length-b;$(".marker-bar").addClass("hide");
$(".marker-bar").eq(a).removeClass("hide").parents(".amap-marker").css({"z-index":zIndex});zIndex++;}window.onload=function(){var a=setInterval(function(){$(".loading").addClass("hide");
$(".main").removeClass("hide");clearInterval(a);},500);new BuildDataAndSlider($(".stop")[0]);new NMPhotoSlider($(".stop ul")[0],0);if(window.navigator.userAgent.indexOf("iPhone")!=-1&&window.navigator.userAgent.indexOf("UCBrowser/10.7.1.655")!=-1){$(".footer").css("bottom","40px");
$(".amap-zoomcontrol").css("bottom","40px");}};function isAnimation(a){return !!($(a).attr("style").indexOf("transition")!=-1||$(a).attr("style").indexOf("webkitTransition")!=-1);
}function deal6Decimal(d){var a=d.split(".");if(!a[1]){return a[0]+".000000";}else{if(a[1].length>=6){return a[0]+"."+a[1].substring(0,6);}else{if(a[1].length<6){for(var c=0,b=a[0]+"."+a[1];
c<6-a[1].length;c++){b=b+"0";}return b;}}}}$(".header a").click(function(){window.history.back();});var map=new AMap.Map($("#container")[0]);map.setZoom(setZoom);
if(!!stopData[0]){map.setCenter(stopData[0].stopLnglat);}else{map.setCenter(venueLnglat);}var hide="";if(!!stopData[0]){hide="hide";}var marker=new AMap.Marker({position:venueLnglat,draggable:false,cursor:"auto",content:"<div class='nm-amap-marker'><i class='marker-icon'><img src='/static/amap/images/v-location.png'></i><div class='marker-bar "+hide+"'><h2>"+venueData.vName+"</h2><h3>"+venueData.vAddress+"</h3></div></div>",animation:""});
marker.setMap(map);var firstStopDistanceList=[];$.each(stopData,function(a,b){firstStopDistanceList.push(firstStopDistance(b.stopLnglat[0]-0,b.stopLnglat[1]-0));
});firstStopDistanceList.push(firstStopDistance(venueData.vLnglat[0]-0,venueData.vLnglat[1]-0));firstStopDistanceList.sort(compare);if(firstStopDistanceList[0]){if(firstStopDistanceList[0]*1>6){setZoom=11;
}else{if(firstStopDistanceList[0]*1>4){setZoom=12;}else{if(firstStopDistanceList[0]*1>2){setZoom=13;}else{if(firstStopDistanceList[0]*1>0.5){setZoom=14;
}}}}map.setZoom(setZoom);}function compare(b,a){if(b<a){return 1;}else{if(b>a){return -1;}else{return 0;}}}var markerList=[];$.each(stopData,function(c,d){var b="hide";
if(c==0){b="";}var a=new AMap.Marker({position:d.stopLnglat,draggable:false,cursor:"auto",content:"<div class='nm-amap-marker'><i class='marker-icon'><img src='/static/amap/images/p-location.png'></i><div class='marker-bar "+b+"'><h2>"+d.stopName+"</h2><h3>距场馆"+venueDistance(d.stopLnglat[0]-0,d.stopLnglat[1]-0)+"km</h3></div></div>",animation:""});
markerList.push(a);markerListSetMap();});function markerListSetMap(){if(markerList.length==stopData.length){for(var a=markerList.length-1;a>=0;a--){markerList[a].setMap(map);
}}}map.plugin("AMap.Geolocation",function(){var a=new AMap.Geolocation({enableHighAccuracy:true,timeout:10000,maximumAge:0,convert:true,showButton:true,buttonPosition:"LB",buttonOffset:new AMap.Pixel(10,70),showMarker:true,showCircle:true,panToLocation:true,zoomToAccuracy:true});
map.addControl(a);AMap.event.addListener(a,"complete",onComplete);AMap.event.addListener(a,"error",onError);});map.plugin(["AMap.ToolBar"],function(){var a=new AMap.ToolBar({offset:new AMap.Pixel(10,130)});
map.addControl(a);});function onComplete(a){}function onError(a){}function venueDistance(a,b){var a=a*1;var b=b*1;if(!orilnglat){return false;}return(orilnglat.distance([a,b])/1000).toFixed(2);
}function firstStopDistance(a,c){var a=a*1;var c=c*1;if(!stopData[0]){return false;}var b=new AMap.LngLat(stopData[0].stopLnglat[0]-0,stopData[0].stopLnglat[1]-0);
return(b.distance([a,c])/1000).toFixed(2);}function gotoSomeWhere(b,c){var b=b;var a=[];var d=c;if(!!$("body").attr("data-location-lnglat")){a=$("body").attr("data-location-lnglat").split(",");
window.location.href="//m.amap.com/navi/?start="+a[0]+","+a[1]+"&dest="+b[0]+","+b[1]+"&destName="+d+"&key="+amapKey+"&naviBy=car";}else{window.location.href="//m.amap.com/navi/?&dest="+b[0]+","+b[1]+"&destName="+d+"&key="+amapKey+"&naviBy=car";
}}function getURLInformation(){var c={};if(window.location.href.split("#")[0].split("?")[1]){var b=window.location.href.split("#")[0].split("?")[1].split("&");
}if(b){for(var a=0;a<b.length;a++){c[b[a].split("=")[0]]=b[a].split("=")[1]||"";}}return c;}